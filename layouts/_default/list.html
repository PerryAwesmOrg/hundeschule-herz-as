{{ define "main" }}

<div class="page-wrapper">
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <div class="post post-single">
          <h2 class="post-title">{{ .Title }}</h2>
          <div class="post-content post-excerpt">
            {{ .Content }}
          </div>
        </div>

        {{/* 1) Erst sortieren, dann paginieren (ignoriert weight komplett) */}}
        {{ $pages := .RegularPages.ByDate.Reverse }}
        {{ $paginator := .Paginate $pages }}

        {{ range $paginator.Pages }}
        <div class="post">
          <h3 class="post-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
          <div class="post-content">
            <p>{{ .Summary }}</p>
            <a href="{{ .Permalink }}" class="btn btn-main">Erfahre mehr</a>
          </div>
        </div>
        {{ end }}

        {{/* 2) Pagination mit robusten SVG-Pfeilen (keine Icon-Fonts nötig) */}}
        {{ if gt $paginator.TotalPages 1 }}
        <nav class="text-center" aria-label="Pagination">
          <ul class="pagination post-pagination">
            {{ if $paginator.HasPrev }}
            <li>
              <a href="{{ $paginator.Prev.URL }}" class="page-link" aria-label="Vorherige Seite">
                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:-2px;">
                  <path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="sr-only">Zurück</span>
              </a>
            </li>
            {{ end }}

            {{/* Seitenzahlen wie gehabt */}}
            {{ $adjacent_links := 2 }}
            {{ $max_links := (add (mul $adjacent_links 2) 1) }}
            {{ $lower_limit := (add $adjacent_links 1) }}
            {{ $upper_limit := (sub $paginator.TotalPages $adjacent_links) }}

            {{ range $paginator.Pagers }}
              {{ $.Scratch.Set "page_number_flag" false }}
              {{ if gt $paginator.TotalPages $max_links }}
                {{ if le $paginator.PageNumber $lower_limit }}
                  {{ if le .PageNumber $max_links }}{{ $.Scratch.Set "page_number_flag" true }}{{ end }}
                {{ else if ge $paginator.PageNumber $upper_limit }}
                  {{ if gt .PageNumber (sub $paginator.TotalPages $max_links) }}{{ $.Scratch.Set "page_number_flag" true }}{{ end }}
                {{ else }}
                  {{ if and ( ge .PageNumber (sub $paginator.PageNumber $adjacent_links) ) ( le .PageNumber (add $paginator.PageNumber $adjacent_links) ) }}
                    {{ $.Scratch.Set "page_number_flag" true }}
                  {{ end }}
                {{ end }}
              {{ else }}
                {{ $.Scratch.Set "page_number_flag" true }}
              {{ end }}

              {{ if eq ($.Scratch.Get "page_number_flag") true }}
              <li class="{{ if eq . $paginator }} active {{ end }}">
                <a href="{{ .URL }}">{{ .PageNumber }}</a>
              </li>
              {{ end }}
            {{ end }}

            {{ if $paginator.HasNext }}
            <li>
              <a href="{{ $paginator.Next.URL }}" class="page-link" aria-label="Nächste Seite">
                <span class="sr-only">Weiter</span>
                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:-2px;">
                  <path d="M9 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </li>
            {{ end }}
          </ul>
        </nav>
        {{ end }}

      </div>
      <div class="col-md-4">
        {{ partial "blog-sidebar.html" . }}
      </div>
    </div>
  </div>
</div>

{{ end }}
